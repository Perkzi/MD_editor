import{_ as R,r as C,w as D,a as f,o as p,c as b,b as e,d as _,e as m,u as h,s as ee,n as V,f as y,g as N,p as J,h as L,i as T,F as j,j as K,t as U,k as te,l as z,m as ne,q as H,v as A,x as oe,E as q,y as S,z as se,A as ae}from"./index-165ccd21.js";import{C as ie}from"./index-c56556f7.js";import{s as le,c as ce}from"./index-6a53ba0f.js";import"./index-d3491f83.js";const k=t=>(J("data-v-ac9ad3e4"),t=t(),L(),t),re={class:"aside"},de=k(()=>e("div",{class:"aside-logo"},[e("i",{class:"iconfont icon-circulation"}),e("span",{title:"Multi Person Online Editor"}," Multi Person Online Editor ")],-1)),ue={class:"aside-search"},pe=k(()=>e("i",{class:"iconfont icon-shouye-zhihui"},null,-1)),_e=k(()=>e("span",null," Home ",-1)),me=[pe,_e],he=k(()=>e("i",{class:"iconfont icon-shujugongxiang"},null,-1)),fe=k(()=>e("span",null," Share with me ",-1)),ge=[he,fe],ve=k(()=>e("i",{class:"iconfont icon-huishouzhan"},null,-1)),ye=k(()=>e("span",null," bin ",-1)),xe=[ve,ye],we={__name:"aside",props:{activeMenu:{type:String,default:"pages"}},setup(t){const o=C("");D(o,s=>N.commit("setSearchKeyWord",s));const r=s=>y.push(`/home/${s}`);return(s,n)=>{const i=f("el-icon"),l=f("el-input");return p(),b("div",re,[de,e("div",ue,[_(l,{placeholder:"search",modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=c=>o.value=c),clearable:""},{prefix:m(()=>[_(i,null,{default:m(()=>[_(h(ee))]),_:1})]),_:1},8,["modelValue"])]),e("div",{class:V(["aside-icon",{active:t.activeMenu==="pages"}]),onClick:n[1]||(n[1]=c=>r("pages"))},me,2),e("div",{class:V(["aside-icon",{active:t.activeMenu==="share"}]),onClick:n[2]||(n[2]=c=>r("share"))},ge,2),e("div",{class:"aside-bottom",onClick:n[3]||(n[3]=c=>h(y).push("/recycle"))},xe)])}}},Ce=R(we,[["__scopeId","data-v-ac9ad3e4"]]);const be={style:{width:"100%",height:"100%"}},ke={class:"dropdownItem"},$e=["title"],Se={__name:"index",props:{trigger:{type:String,default:"click"},list:{type:Array,default:()=>[]}},emits:["handleCommand","handleOpen","handleClose"],setup(t,{emit:o}){const r=i=>o("handleCommand",i),s=()=>o("handleOpen"),n=()=>o("handleClose");return(i,l)=>{const c=f("el-dropdown-item"),g=f("el-dropdown-menu"),v=f("el-dropdown");return p(),T(v,{trigger:t.trigger,onHandleOpen:s,onHandleClose:n,onCommand:r},{dropdown:m(()=>[_(g,null,{default:m(()=>[(p(!0),b(j,null,K(t.list,d=>(p(),T(c,{key:d.command,command:d.command},{default:m(()=>[e("div",ke,[e("i",{class:V(["iconfont",d.icon])},null,2),e("span",{title:d.name},U(d.name),9,$e)])]),_:2},1032,["command"]))),128))]),_:1})]),default:m(()=>[e("div",be,[te(i.$slots,"content",{},void 0,!0)])]),_:3},8,["trigger"])}}},Me=R(Se,[["__scopeId","data-v-d3abf79c"]]),Ie=(t,o,r="Typora")=>new Promise((s,n)=>{if(t.name.split(".")[1]==="md"){let l=new FileReader;l.readAsText(t,"UTF-8"),l.onloadend=async c=>{c.target.readyState!==2&&n({msg:"文件读写失败"});let g=Te(c.target.result.toString().split(`
`)),{userid:v}=JSON.parse(sessionStorage.getItem("user")),d=await le({fileid:o,userid:v,content:g});d.code!==200&&n(d),s(d)}}});function Te(t,o){let r=[];return t.forEach(s=>{let n=s&&s.match(/^[#]+|[*]+[\u4e00-\u9fa5|\d|a-z|A-Z|-]|[~~~]{3}|[<][u][>]|[\]][(]/g);if(!n)return r.push({insert:P(s)});let i=null;n.forEach(l=>{l.toString().includes("#")&&(i=l.length)}),r.push({insert:P(s),attributes:{header:i}})}),JSON.stringify(r)}function P(t){return t.replace(/[']/g,"#[d]#").replace(/["]/g,"#[s]#").replace(/^#+/g,"")}const M=t=>(J("data-v-eff665de"),t=t(),L(),t),Re={class:"top-left"},Oe=M(()=>e("i",{class:"iconfont icon-xinjian"},null,-1)),Be=M(()=>e("span",null,"create",-1)),Ee=M(()=>e("i",{class:"iconfont icon-daoru"},null,-1)),He=M(()=>e("span",null,"import",-1)),Ve=M(()=>e("i",{class:"iconfont icon-duqumoban"},null,-1)),Ne=M(()=>e("span",null,"template",-1)),ze={class:"top-right"},Fe={class:"top-right-user"},Ae=["innerHTML"],qe={key:2,class:"iconfont icon-tipvip"},Pe={__name:"top",setup(t){let o=C(!0),r=C("");const s=z([{name:"个人中心",command:"user",icon:"icon-zhanghao"},{name:"系统设置",command:"setting",icon:"icon-shezhi-xianxing"},{name:"项目地址",command:"gitee",icon:"icon-github-fill"},{name:"退出系统",command:"exit",icon:"icon-tuichu"}]),n=z({show:!1}),i=a=>{switch(a){case"user":y.push("/user");break;case"gitee":window.open("https://github.com/heeler-deer/SEMD");break;case"setting":n.show=!0;break;case"exit":sessionStorage.clear(),y.push("/login");break}},l=()=>y.push("/template");let c=C(null),g=C(!1);const v=async a=>{g.value=!0,await oe(),c.value.showContentMenu(a,!0)},d=()=>g.value=!1,W=a=>N.commit("setTopCreateData",a);let O=C(null);const Z=async a=>{const u=a.target.files[0];try{await q.confirm(`确认上传 ${u.name} 进行协同吗？`,"文件上传",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),G(u)}catch{S.info("已取消")}O.value.value=""},G=async a=>{let u=JSON.parse(sessionStorage.getItem("user")).userid,x=a.name.split(".")[0],w=a.name.split(".")[1],B={md:"markdown",txt:"txt",doc:"word",docx:"word",xls:"excel",xlsx:"excel"}[w],Q=y.currentRoute.value.query.folderid,X=Math.random().toString().split(".")[1].slice(0,3),$=await ce({userid:u,filename:x,filesuffix:w,filetype:B,fileownerfolderid:Q});if($.code!==200)return S.error("导入失败，"+$.msg);S.success("文件导入成功！");let Y={id:$.data,name:X,suffix:w,type:B};N.commit("setTopCreateData",Y);let E=await Ie(a,$.data,"Typora");if(E.code!==200)return S.error(E.msg);S.success(E.msg);try{await q.confirm("是否立即打开文件？","打开文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let F={filename:x,filesuffix:w,filetype:B,owner:u};y.push({path:w==="xlsx"?`/excel/${$.data}`:`/edit/${$.data}`,query:F})}catch{S.info("已取消")}};return ne(()=>{let a=JSON.parse(sessionStorage.getItem("user"));o.value=a.vip,r.value=a.userimg}),(a,u)=>{const x=f("el-button"),w=f("el-avatar");return p(),b("div",{class:"top",onClick:u[2]||(u[2]=H((...I)=>a.hiddenContentMenu&&a.hiddenContentMenu(...I),["stop"]))},[e("div",Re,[_(x,{type:"primary",onClick:u[0]||(u[0]=H(I=>v(I),["stop"]))},{default:m(()=>[Oe,Be]),_:1}),_(x,{text:"",onClick:u[1]||(u[1]=H(I=>h(O).click(),["stop"]))},{default:m(()=>[Ee,He]),_:1}),_(x,{text:"",onClick:l},{default:m(()=>[Ve,Ne]),_:1})]),e("div",ze,[e("div",Fe,[_(Me,{list:s,onCommand:i},{content:m(()=>[h(r)?(p(),b("div",{key:0,class:"userimg_svg",innerHTML:h(r)},null,8,Ae)):(p(),T(w,{key:1,shape:"square",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"})),h(o)?(p(),b("i",qe)):A("",!0)]),_:1},8,["list"])])]),h(g)?(p(),T(ie,{key:0,ref_key:"contentmenuRef",ref:c,onCreate:W,onClose:d},null,512)):A("",!0),e("input",{type:"file",onChange:Z,style:{display:"none"},accept:"*",ref_key:"inputRef",ref:O},null,544)])}}},De=R(Pe,[["__scopeId","data-v-eff665de"]]);const Je={class:"home"},Le={class:"home-main"},je={__name:"index",setup(t){let o=z([{title:"Home",path:"/home/pages"}]),r=[{path:"share",title:"Share with me"}],s=C("pages");return D(y.currentRoute,n=>{let i=n.path.split("/")[2];s=i;let l=r.find(c=>c.path===i);o.length===1&&i==="pages"||(o.length>1&&o.pop(),l&&o.push({title:l.title,path:`/home/${l.path}`}))},{deep:!0,immediate:!0}),(n,i)=>{const l=f("el-breadcrumb-item"),c=f("el-breadcrumb"),g=f("router-view");return p(),b("div",Je,[_(Ce,{activeMenu:h(s)},null,8,["activeMenu"]),e("div",Le,[_(De),_(c,{class:"home-main-bread","separator-icon":h(ae)},{default:m(()=>[(p(!0),b(j,null,K(h(o),(v,d)=>(p(),T(l,{key:d,to:{path:v.path}},{default:m(()=>[se(U(v.title),1)]),_:2},1032,["to"]))),128))]),_:1},8,["separator-icon"]),_(g,{style:{flex:"auto",padding:"10px 20px"}})])])}}},Ge=R(je,[["__scopeId","data-v-bf056fda"]]);export{Ge as default};
